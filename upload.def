BootStrap: docker
From: python:3.8-slim-bullseye

%setup
    # Anything here are executed on the BUILD HOST (not the running host)
    # wget https://raw.githubusercontent.com/ivadomed/ivadomed/master/requirements_dev.txt
    # wget https://raw.githubusercontent.com/ivadomed/ivadomed/master/requirements.txt


%files
    # Create and Copy files during setup stage.

%post
    # Actual setup stage
    # run a simple test with this data: /app/data/model_final.pkl
    /usr/local/bin/python -m pip install --upgrade pip
    pip --version
    python --version
    python3 --version

    # Install the google api library
    pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib
    pip list
    python upload.py


%runscript
    echo "Container was created $(date) by $(whoami)"
    echo "Arguments received: $*"
    exec echo "$@"
    echo "Friendly reminder: /home from your Host Environment is automatically mirrored/mapped inside the Singularity Container"

%labels
    Author developers at ivadomed.org
    Version v0.0.1
    GPU True

%help
    This is an experimental Singularity Container build to support ivadomed within the Compute Canada
    Environment.

    Automatically, $HOME, /tmp, /proc, /sys, /dev are mounted into the Singularity Container

# Final build commands (on a system with singularity built):
# sudo singularity build --notest ivadomed_master.sif ivadomed_singularity_master.def